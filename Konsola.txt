Ładowanie wymaganego pakietu: NLP

Dołączanie pakietu: ‘NLP’

Następujący obiekt został zakryty z ‘package:ggplot2’:

    annotate

Komunikat ostrzegawczy:
pakiet ‘tm’ został zbudowany w wersji R 4.0.5 
> library("SnowballC")
> library("wordcloud")
Ładowanie wymaganego pakietu: RColorBrewer
Komunikat ostrzegawczy:
pakiet ‘wordcloud’ został zbudowany w wersji R 4.0.5 
> library("RColorBrewer")
> library("syuzhet")
Komunikat ostrzegawczy:
pakiet ‘syuzhet’ został zbudowany w wersji R 4.0.5 
> library("ggplot2")
> # Read the text file from local machine , choose file interactively
> text <- readLines(file.choose())
Komunikat ostrzegawczy:
W poleceniu 'readLines(file.choose())':
  niekompletna końcowa linia znaleziona w 'C:\Users\DK\Desktop\MGR\APU\LAB7\Tesla.txt'
> # Load the data as a corpus
> TextDoc <- Corpus(VectorSource(text))
> #Replacing "/", "@" and "|" with space
> toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
> TextDoc <- tm_map(TextDoc, toSpace, "/")
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, toSpace, "/")':
  transformation drops documents
> TextDoc <- tm_map(TextDoc, toSpace, "@")
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, toSpace, "@")':
  transformation drops documents
> TextDoc <- tm_map(TextDoc, toSpace, "\\|")
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, toSpace, "\\|")':
  transformation drops documents
> # Convert the text to lower case
> TextDoc <- tm_map(TextDoc, content_transformer(tolower))
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, content_transformer(tolower))':
  transformation drops documents
> # Remove numbers
> TextDoc <- tm_map(TextDoc, removeNumbers)
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, removeNumbers)':
  transformation drops documents
> # Remove english common stopwords
> TextDoc <- tm_map(TextDoc, removeWords, stopwords("english"))
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, removeWords, stopwords("english"))':
  transformation drops documents
> # Remove your own stop word
> # specify your custom stopwords as a character vector
> TextDoc <- tm_map(TextDoc, removeWords, c("s", "company", "team")) 
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, removeWords, c("s", "company", "team"))':
  transformation drops documents
> # Remove punctuations
> TextDoc <- tm_map(TextDoc, removePunctuation)
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, removePunctuation)':
  transformation drops documents
> # Eliminate extra white spaces
> TextDoc <- tm_map(TextDoc, stripWhitespace)
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, stripWhitespace)':
  transformation drops documents
> # Text stemming - which reduces words to their root form
> TextDoc <- tm_map(TextDoc, stemDocument)
Komunikat ostrzegawczy:
W poleceniu 'tm_map.SimpleCorpus(TextDoc, stemDocument)':
  transformation drops documents
> # Build a term-document matrix
> TextDoc_dtm <- TermDocumentMatrix(TextDoc)
> dtm_m <- as.matrix(TextDoc_dtm)
> # Sort by descearing value of frequency
> dtm_v <- sort(rowSums(dtm_m),decreasing=TRUE)
> dtm_d <- data.frame(word = names(dtm_v),freq=dtm_v)
> # Display the top 5 most frequent words
> head(dtm_d, 5)
           word freq
tesla     tesla  396
model     model  160
car         car  107
vehicl   vehicl   95
batteri batteri   77
> # Plot the most frequent words
> barplot(dtm_d[1:5,]$freq, las = 2, names.arg = dtm_d[1:5,]$word,
+         col ="lightgreen", main ="Top 5 most frequent words",
+         ylab = "Word frequencies")
> #generate word cloud
> set.seed(1234)
> wordcloud(words = dtm_d$word, freq = dtm_d$freq, min.freq = 5,
+           max.words=100, random.order=FALSE, rot.per=0.40, 
+           colors=brewer.pal(8, "Dark2"))
> # Find associations 
> findAssocs(TextDoc_dtm, terms = c("good","work","health"), corlimit = 0.25)			
$good
numeric(0)

$work
coronavirus     alameda      counti        back       covid    contract      effect      exclus       prăľm        wind      airbnb       chain     instanc 
       0.53        0.48        0.44        0.43        0.40        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38 
      minor      select       aabar         abu      bought       dhabi       edriv        hold        ipic   petroleum       stake  vicepresid        cnbc 
       0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38 
      crisi        defi      exempt     fascist       given    governor       impos        keep         lax   noncompli     precaut     rescind     restart 
       0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38 
    stayhom    surround        fear        feel        grew     inadequ      measur     subsequ   uncomfort         big       burri       climb         cnn 
       0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.38 
    collect        lost     percept     portray      seller       shape stockaccord        much       short     employe     daimler      worker    grohmann 
       0.38        0.38        0.38        0.38        0.38        0.38        0.38        0.37        0.36        0.35        0.35        0.34        0.33 
        may     factori        stay      reopen      critic        late       still       stock       futur     fremont        home      accord        help 
       0.33        0.33        0.33        0.33        0.33        0.30        0.30        0.29        0.28        0.28        0.26        0.26        0.26 
       want     michael         own        firm        safe       dedic       hotel      remain       mobil      period       bring     continu      employ 
       0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26 
   plainsit      govern       local      german      togeth     herbert      kohler     portion        case      despit        deni     express        tell 
       0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26        0.26 
     pandem      negoti     publish       tslaq       order 
       0.26        0.26        0.26        0.26        0.25 

$health
    alameda      counti coronavirus        cnbc       crisi        defi      exempt     fascist       given    governor       impos        keep         lax 
       0.90        0.87        0.87        0.82        0.82        0.82        0.82        0.82        0.82        0.82        0.82        0.82        0.82 
  noncompli     precaut     rescind     restart     stayhom    surround      reopen        back       order        want       covid        safe       bring 
       0.82        0.82        0.82        0.82        0.82        0.82        0.73        0.71        0.63        0.58        0.58        0.58        0.58 
    continu       local     express      pandem      negoti     publish     factori     fremont     employe        call         act      offici      reason 
       0.58        0.58        0.58        0.58        0.58        0.58        0.55        0.55        0.54        0.54        0.47        0.47        0.47 
       earn      detail      approv        much        fear        feel        grew     inadequ      measur     subsequ   uncomfort    downplay      extent 
       0.47        0.41        0.41        0.41        0.41        0.41        0.41        0.41        0.41        0.41        0.41        0.41        0.41 
     injuri      mandat       occup        osha     podcast     serious      public      worker        stay  california controversi       three      report 
       0.41        0.41        0.41        0.41        0.41        0.41        0.40        0.37        0.36        0.30        0.30        0.30        0.30 
      manag         may        june      period      employ    plainsit         ten      despit        deni        tell   administr        home      govern 
       0.30        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.28        0.28 
       case       earli 
       0.28        0.27 

> # Find associations for words that occur at least 50 times
> findAssocs(TextDoc_dtm, terms = findFreqTerms(TextDoc_dtm, lowfreq = 50), corlimit = 0.25)
$tesla
      also     report        use     accord      first       file      fraud        sec      state     follow       fund        may      claim manufactur 
      0.34       0.34       0.33       0.31       0.31       0.31       0.31       0.31       0.30       0.30       0.30       0.30       0.30       0.29 
   januari       june    factori    concern      price    financi    million     market    analyst       juli california   american     includ     produc 
      0.29       0.29       0.29       0.29       0.28       0.28       0.27       0.27       0.27       0.26       0.26       0.26       0.26       0.26 
   account    lawsuit      later     result      tweet    commiss    practic       well   selfdriv    highway 
      0.26       0.26       0.26       0.26       0.26       0.26       0.26       0.25       0.25       0.25 

$electr
         plug        global       bestsel         world       segment          sinc batteryelectr        captur      gridscal        hybrid          pure 
         0.70          0.53          0.50          0.45          0.42          0.39          0.38          0.38          0.38          0.38          0.38 
      expedit      inventor        tribut          best          sale         sedan         clean          mark          list          rang        nikola 
         0.38          0.38          0.38          0.37          0.36          0.35          0.33          0.33          0.33          0.33          0.32 
      highest        obtain        energi        market          rank      roadster       passeng          sell        storag          unit          also 
         0.32          0.32          0.31          0.31          0.31          0.30          0.30          0.30          0.28          0.28          0.28 
          epa         estim          leaf          long          mile        nissan      consecut        incept        norway        overal         carri 
         0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28 
         elis        falcon        flight         heavi         lotus     marscross           now         orbit        rocket        serial           shi 
         0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28 
          top        better           set           gwh          tile          help          marc        purpos          plus       registr 
         0.27          0.27          0.27          0.26          0.26          0.26          0.26          0.26          0.26          0.26 

$vehicl
          price           volum           allow          higher        highpric             low           lower        lowvolum           oppos        progress 
           0.39            0.38            0.38            0.37            0.36            0.36            0.36            0.36            0.36            0.36 
         sensit            wait          associ           howev        although          defect            mode          custom      manufactur            high 
           0.36            0.36            0.35            0.35            0.35            0.35            0.35            0.33            0.32            0.32 
         believ           nhtsa           found           sport          afford          driver         highway          expens             use         compani 
           0.32            0.32            0.31            0.31            0.31            0.31            0.31            0.31            0.30            0.30 
           well           crash          recent          rather            turn            save         without      fortyeight galleriesâ€”usu           learn 
           0.30            0.30            0.30            0.30            0.30            0.30            0.30            0.29            0.29            0.29 
          lobbi        mallsâ€”        prohibit        restrict           accid         barrier          collid          collis             die         freeway 
           0.29            0.29            0.29            0.29            0.29            0.29            0.29            0.29            0.29            0.29 
           kill        malfunct            play       safetyrel    tractortrail          produc           sedan          luxuri         confirm            near 
           0.29            0.29            0.29            0.29            0.29            0.28            0.28            0.28            0.28            0.28 
          still        demonstr          result           limit          provid            cost        roadster        selfdriv            less             due 
           0.28            0.28            0.27            0.27            0.27            0.27            0.26            0.26            0.26            0.25 
         consum 
           0.25 

$batteri
       applic      canadian        dimens     springpow       tabless          tall          wide          pack          cell         small           gwh 
         0.50          0.50          0.50          0.50          0.50          0.50          0.50          0.44          0.36          0.36          0.35 
          day         refer       decreas         relat        suppli       segment    lithiumion       announc        featur      aluminum        impact 
         0.35          0.35          0.35          0.34          0.34          0.31          0.31          0.30          0.30          0.30          0.30 
      generat          fire batteryelectr        captur      gridscal        hybrid          pure      supplier          rang        intern         close 
         0.29          0.29          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28 
       caught         cover         decis        extend          inch          kent         metal      noncrash        object         prone        replac 
         0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28          0.28 
       shield      threelay    washington        energi       current          week        nevada       develop          plug       panason         estim 
         0.28          0.28          0.28          0.27          0.27          0.27          0.27          0.26          0.26          0.26          0.26 
       storag          said        design 
         0.25          0.25          0.25 

$musk
   director       board     appoint       civil    classact   constitut     counsel       deriv   goingpriv       parti     pertain      review       settl 
       0.58        0.53        0.52        0.52        0.52        0.52        0.52        0.52        0.52        0.52        0.52        0.52        0.52 
temporarili    transact   statement      member       fraud         sec        fund       tweet        fals        elon     lawsuit        role   sharehold 
       0.52        0.52        0.51        0.48        0.47        0.47        0.46        0.46        0.46        0.45        0.42        0.42        0.42 
      later      consid        rise        drop      reveal    independ        agre      privat         two         put     exchang     commiss     penalti 
       0.41        0.41        0.41        0.41        0.39        0.38        0.36        0.36        0.36        0.36        0.36        0.36        0.36 
     decemb        five        duti        hous     respond    investor      approv        take     potenti       legal    solarpow      breach   fiduciari 
       0.35        0.35        0.33        0.33        0.33        0.32        0.32        0.32        0.32        0.32        0.31        0.31        0.31 
     includ      accord        also  settlement       chief       count        done       gonna        know         lag  massproduc        miss      precis 
       0.30        0.30        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29 
   punctual        push      repeat       revis     sometim      strong      suppos      target        amaz        brad     brother        buss  capitalist 
       0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29 
      check  groupthink   influenti   judgement   jurvetson   nonexecut  profession      promis       retir         sit     teacher         tie     twitter 
       0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29        0.29 
      wrote    chairman         may       major      spacex      action      public     million        call        made      letter       worth         ask 
       0.29        0.28        0.28        0.27        0.27        0.27        0.26        0.26        0.26        0.26        0.26        0.25        0.25 
      stock         six      pickup      intent         get      kimbal 
       0.25        0.25        0.25        0.25        0.25        0.25 

$product
   convert    project     energi      sedan    anticip    briefli      meant    overcom      plagu     prompt    rollout      carri       elis     falcon 
      0.37       0.36       0.35       0.33       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32 
    flight      heavi      lotus  marscross        now      orbit     rocket     serial     bureau    dismiss        fbi      figur     imposs       misl 
      0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32 
 stockhold      unrel      count       done      gonna       know        lag massproduc       miss     precis   punctual       push     repeat      revis 
      0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32       0.32 
   sometim     strong     suppos     target   roadster   commerci    predict     storag        one      began powertrain       date 
      0.32       0.32       0.32       0.32       0.30       0.29       0.29       0.27       0.27       0.27       0.26       0.25 

$model
   sedan     year   higher     less    volum    march    began highpric      low    lower lowvolum    oppos progress   sensit     wait    front    world     near 
    0.39     0.38     0.38     0.35     0.34     0.33     0.32     0.32     0.32     0.32     0.32     0.32     0.32     0.32     0.32     0.32     0.31     0.31 
   first   produc   recent     unit  expedit inventor   tribut   luxuri  highway    nhtsa  bestsel     best   expens  crossov previous     sell     plug    still 
    0.30     0.29     0.29     0.28     0.28     0.28     0.28     0.28     0.28     0.28     0.27     0.27     0.27     0.26     0.26     0.26     0.25     0.25 

$car
      year        won      trend       list    countri       plug       rank      world      place       best    bestsel      first      sedan   fivedoor 
      0.57       0.48       0.45       0.44       0.42       0.41       0.40       0.39       0.38       0.38       0.37       0.37       0.37       0.37 
    invent   liftback    magazin       sale        top      becam        per       sell       less       came       sinc     produc     achiev       ceas 
      0.37       0.37       0.37       0.36       0.36       0.35       0.35       0.34       0.34       0.34       0.32       0.31       0.31       0.31 
    luxuri        got    unlimit   roadster       free     higher    cheaper    hardwar       time      month       june   deliveri      offer      estim 
      0.31       0.31       0.31       0.30       0.29       0.29       0.29       0.28       0.27       0.27       0.27       0.27       0.27       0.27 
supercharg       come       near        new      volum      sport        kwh      rough 
      0.27       0.27       0.27       0.26       0.26       0.26       0.26       0.25 

> # regular sentiment score using get_sentiment() function and method of your choice
> # please note that different methods may have different scales
> syuzhet_vector <- get_sentiment(text, method="syuzhet")
> # see the first row of the vector
> head(syuzhet_vector)
[1] 0.00 0.50 0.00 0.75 0.00 0.00
> # see summary statistics of the vector
> summary(syuzhet_vector)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-6.2000  0.0000  0.0000  0.3337  0.4000  5.9500 
> # bing
> bing_vector <- get_sentiment(text, method="bing")
> head(bing_vector)
[1] 0 1 0 1 0 0
> summary(bing_vector)
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-9.00000  0.00000  0.00000  0.01977  0.00000  7.00000 
> #affin
> afinn_vector <- get_sentiment(text, method="afinn")
> head(afinn_vector)
[1] 0 1 0 2 0 0
> summary(afinn_vector)
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
-19.00000   0.00000   0.00000   0.03295   0.00000  14.00000 
> #compare the first row of each vector using sign function
> rbind(
+   sign(head(syuzhet_vector)),
+   sign(head(bing_vector)),
+   sign(head(afinn_vector))
+ )
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    0    1    0    1    0    0
[2,]    0    1    0    1    0    0
[3,]    0    1    0    1    0    0
> # run nrc sentiment analysis to return data frame with each row classified as one of the following
> # emotions, rather than a score: 
> # anger, anticipation, disgust, fear, joy, sadness, surprise, trust 
> # It also counts the number of positive and negative emotions found in each row
> d<-get_nrc_sentiment(text)
> # head(d,10) - to see top 10 lines of the get_nrc_sentiment dataframe
> head (d,10)
   anger anticipation disgust fear joy sadness surprise trust negative positive
1      0            0       0    0   0       0        0     0        0        0
2      0            0       0    0   0       0        0     1        0        1
3      0            0       0    0   1       0        0     0        0        1
4      0            0       0    0   2       0        1     1        0        3
5      0            0       0    0   0       0        0     0        0        0
6      0            0       0    0   0       0        0     0        0        0
7      0            0       0    0   0       0        0     0        0        0
8      0            0       0    0   0       0        0     0        0        1
9      0            0       0    0   0       0        0     0        0        0
10     0            0       0    0   0       0        0     0        0        0
> #transpose
> td<-data.frame(t(d))
> #The function rowSums computes column sums across rows for each level of a grouping variable.
> td_new <- data.frame(rowSums(td[2:253]))
> #Transformation and cleaning
> names(td_new)[1] <- "count"
> td_new <- cbind("sentiment" = rownames(td_new), td_new)
> rownames(td_new) <- NULL
> td_new2<-td_new[1:8,]
> #Plot One - count of words associated with each sentiment
> quickplot(sentiment, data=td_new2, weight=count, geom="bar", fill=sentiment, ylab="count")+ggtitle("Survey sentiments")
> #Plot two - count of words associated with each sentiment, expressed as a percentage
> barplot(
+   sort(colSums(prop.table(d[, 1:8]))), 
+   horiz = TRUE, 
+   cex.names = 0.7, 
+   las = 1, 
+   main = "Emotions in Text", xlab="Percentage"
+ )
> install.packages("tidytext") 
Error in install.packages : Updating loaded packages
> install.packages("tidytext")
Warning in install.packages :
  package ‘tidytext’ is in use and will not be installed
> install.packages("igraph") 
Error in install.packages : Updating loaded packages
> install.packages("igraph")
Warning in install.packages :
  package ‘igraph’ is in use and will not be installed
> library("tidytext")
> library("igraph")
> library("ggraph")
> fileName <- 'C:/Users/DK/Desktop/MGR/APU/LAB7/Tesla.txt'
> text <- readLines(file.choose())
Komunikat ostrzegawczy:
W poleceniu 'readLines(file.choose())':
  niekompletna końcowa linia znaleziona w 'C:\Users\DK\Desktop\MGR\APU\LAB7\Tesla.txt'
> library(dplyr)
> text_df <- data_frame(line = 1, text = iconv(text,"cp1250","CP852"))
> text_df
# A tibble: 607 x 2
    line text                                                                                                          
   <dbl> <chr>                                                                                                         
 1     1 "Tesla, Inc."                                                                                                 
 2     1 "From Wikipedia, the free encyclopedia"                                                                       
 3     1 "Jump to navigationJump to search"                                                                            
 4     1 "This article is about the electric vehicle manufacturer and clean energy company. For other uses, see Tesla."
 5     1 "\"Tesla Motors\" redirects here. For Nikola Tesla's motors, see Induction motor and AC motor."               
 6     1 "Tesla, Inc."                                                                                                 
 7     1 "Tesla Motors.svg"                                                                                            
 8     1 "Tesla Visit 3 (9267529364).jpg"                                                                              
 9     1 "Headquarters in Palo Alto"                                                                                   
10     1  NA                                                                                                           
# ... with 597 more rows
> library(tidytext)
> tidy_text <- text_df %>%
+   unnest_tokens(word, text)
> data(stop_words)
> # we add some old words to stop_words
> de <- data.frame("thy","OLD_WORDS")
> names(de) <- c("word","lexicon")
> stop_words <- rbind(stop_words,de)
> de <- data.frame("1","OLD_WORDS")
> names(de) <- c("word","lexicon")
> de <- data.frame("hath","OLD_WORDS")
> names(de) <- c("word","lexicon")
> de <- data.frame("mar’d","OLD_WORDS")
> names(de) <- c("word","lexicon")
> stop_words <- rbind(stop_words,de)
> #----------------------
> tidy_text <- tidy_text %>%
+   anti_join(stop_words)
Joining, by = "word"
> tidy_text %>%
+   count(word, sort = TRUE)
# A tibble: 2,512 x 2
   word         n
   <chr>    <int>
 1 tesla      324
 2 model      147
 3 2020        81
 4 company     63
 5 battery     62
 6 car         56
 7 musk        56
 8 3           53
 9 electric    51
10 tesla's     50
# ... with 2,502 more rows
> #----- Bigrams ---------------
> text_bigrams <- text_df %>%
+   unnest_tokens(bigram, text, token = "ngrams", n = 2)
> text_bigrams
# A tibble: 11,435 x 2
    line bigram           
   <dbl> <chr>            
 1     1 tesla inc        
 2     1 from wikipedia   
 3     1 wikipedia the    
 4     1 the free         
 5     1 free encyclopedia
 6     1 jump to          
 7     1 to navigationjump
 8     1 navigationjump to
 9     1 to search        
10     1 this article     
# ... with 11,425 more rows
> text_bigrams %>%
+   count(bigram, sort = TRUE)
# A tibble: 8,087 x 2
   bigram            n
   <chr>         <int>
 1 NA              238
 2 of the           63
 3 the model        50
 4 in the           49
 5 model s          47
 6 model 3          43
 7 the company      43
 8 the tesla        28
 9 the first        26
10 united states    26
# ... with 8,077 more rows
> library(tidyr)
> bigrams_separated <- text_bigrams %>%
+   separate(bigram, c("word1", "word2"), sep = " ")
> bigrams_filtered <- bigrams_separated %>%
+   filter(!word1 %in% stop_words$word) %>%
+   filter(!word2 %in% stop_words$word)
> # new bigram counts:
> bigram_counts <- bigrams_filtered %>%
+   count(word1, word2, sort = TRUE)
> bigram_counts
# A tibble: 3,067 x 3
   word1    word2       n
   <chr>    <chr>   <int>
 1 NA       NA        238
 2 model    3          43
 3 tesla    model      23
 4 2020     tesla      20
 5 electric car        19
 6 main     article    16
 7 elon     musk       15
 8 article  tesla      14
 9 energy   storage    10
10 selling  plug       10
# ... with 3,057 more rows
> bigrams_united <- bigrams_filtered %>%
+   unite(bigram, word1, word2, sep = " ")
> bigrams_united
# A tibble: 4,011 x 2
    line bigram              
   <dbl> <chr>               
 1     1 free encyclopedia   
 2     1 electric vehicle    
 3     1 vehicle manufacturer
 4     1 clean energy        
 5     1 energy company      
 6     1 tesla motors        
 7     1 motors redirects    
 8     1 nikola tesla's      
 9     1 tesla's motors      
10     1 induction motor     
# ... with 4,001 more rows
> # filter for only relatively common combinations
> bigram_graph <- bigram_counts %>%
+   filter(word1 == "tesla" | word2 == "tesla") %>%
+   graph_from_data_frame()
> bigram_graph4 <- bigram_counts %>%
+   filter(word1 == "elon" | word2 == "elon") %>%
+   graph_from_data_frame()
> bigram_graph5 <- bigram_counts %>%
+   filter(word1 == "model" | word2 == "model") %>%
+   graph_from_data_frame()
> dev.new()
NULL
> ggraph(bigram_graph4, layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), position = "identity") +
+   theme_void()
> dev.new(width = 550, height = 330, unit = "px")
NULL
> ggraph(bigram_graph5, layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), position = "identity") +
+   theme_void()
> # first level
> bigram_graph1 <- bigram_counts %>%
+   filter(word1 %in% c("tesla","elon") | word2 %in%
+            c("tesla","elon"))
> # second level
> bigram_graph2 <- bigram_counts %>%
+   filter(word1 %in% bigram_graph1$word1 | word1 %in%
+            bigram_graph1$word2 | word2 %in% bigram_graph1$word1 |
+            word2 %in% bigram_graph1$word2)
> # end of second level
> # third level
> bigram_graph3 <- bigram_counts %>%
+   filter(word1 %in% bigram_graph2$word1 | word1 %in%
+            bigram_graph2$word2 | word2 %in% bigram_graph2$word1 |
+            word2 %in% bigram_graph2$word2)
> # end of third level
> #################################################################
> bigram_graph
IGRAPH 18c17fb DN-- 201 203 -- 
+ attr: name (v/c), n (e/n)
+ edges from 18c17fb (vertex names):
 [1] tesla     ->model      2020      ->tesla      article   ->tesla      tesla     ->cars       tesla     ->factory    tesla     ->energy    
 [7] tesla     ->motors     tesla     ->semi       2021      ->tesla      tesla     ->announced  tesla     ->autopilot  tesla     ->roadster  
[13] 2010      ->tesla      tesla     ->vehicles   2016      ->tesla      2019      ->tesla      tesla     ->acquired   tesla     ->reported  
[19] tesla     ->solar      2012      ->tesla      2018      ->tesla      tesla     ->issued     tesla     ->owners     tesla     ->vehicle   
[25] 2014      ->tesla      2015      ->tesla      2017      ->tesla      nikola    ->tesla      subsidiary->tesla      taking    ->tesla     
[31] tesla     ->board      tesla     ->cybertruck tesla     ->designed   tesla     ->earned     tesla     ->electric   tesla     ->failed    
[37] tesla     ->india      tesla     ->launched   tesla     ->makes      tesla     ->operates   tesla     ->private    tesla     ->reached   
[43] tesla     ->security   tesla     ->signed     tesla     ->stock      tesla     ->supplied   115,0000  ->tesla      151       ->tesla     
+ ... omitted several edges
> set.seed(2016)
> a <- grid::arrow(type = "closed", length = unit(.15, "inches"))
> ggraph(bigram_graph1%>%graph_from_data_frame(), layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), vjust = 1, hjust = 1) +
+   theme_void()
> ggraph(bigram_graph4, layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), position = "identity") +
+   theme_void()
> ggraph(bigram_graph2%>%graph_from_data_frame(), layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), vjust = 1, hjust = 1) +
+   theme_void()
> dev.new()
NULL
> ggraph(bigram_graph3%>%graph_from_data_frame(), layout = "fr") +
+   geom_edge_link(aes(edge_alpha = n), show.legend = TRUE,
+                  arrow = a, end_cap = circle(.07, "inches")) +
+   geom_node_point(color = "lightblue", size = 5) +
+   geom_node_text(aes(label = name), vjust = 1, hjust = 1) +
+   theme_void()